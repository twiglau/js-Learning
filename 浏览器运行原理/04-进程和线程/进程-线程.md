# 进程和线程

## 线程和进程是操作系统重的两个概念

- 进程(process): 计算机已经运行的程序, 是操作系统管理程序的一种方式

> 一个进程就是一个程序的运行实例
> 启动一个程序的时候, 操作系统会为该程序创建一块内存, 用来存放代码, 运行中的数据和一个执行任务的主线程, 我们把这样的一个运行环境叫做 进程

- 线程(thread): 操作系统能够运行 运算调度的最小单位, 通常情况下 它被包含在进程中

> 多线程可以并行处理任务, 但是线程是不能单独存在的, 它是由进程来启动和管理的

## 解释

- 进程: 我们可以认为, 启动 一个应用程序, 就会默认 启动一个进程 (也可能是多个进程)
- 线程: 每一个进程中, 都会启动至少一个线程用来执行程序中的代码, 这个线程被称之为主线程
- 所以我们也可以说进程是线程的容器
- 线程是依附于进程的, 而进程中使用多线程并行处理 能提升运算效率

## 进程和线程之间的关系

- 1. 进程中的任意一个线程执行出错, 都会导致整个进程的崩溃
- 2. 线程之间共享进程中的数据
- 3. 当一个进程关闭之后, 操作系统会回收进程所占用的内存

> 当一个进程退出时, 操作系统会回收该进程所申请的所有资源;
> 即使其中任意线程因为操作不当导致内存泄漏, 当进程退出时, 这些内存也会被正确回收
> 比如之前的IE浏览器, 支持很多插件, 而这些插件很容易导致内存泄漏, 这意味着只要浏览器开着, 内存占用就有可能会越来越多, 但是当关闭浏览器进程时, 这些内存就都会被系统回收掉

- 4. 进程之间的内容相互隔离

> 进程隔离是为保护操作系统中进程互不干扰的技术, 每一个进程只能访问自己占有的数据, 也就避免出现进程 A 写入数据到 进程 B 的情况.
> 正因为进程之间的数据时严格隔离的, 所以一个进程如果崩溃了, 或者挂起了, 是不会影响到其他进程的.
> 如果进程之间需要进行数据的通信, 就需要使用用于进程间通信 (IPC) 的机制了

## 多进程之间通信

- Electron桌面应用中内部是 chromium 的内核, 有两个进程, 分别是 Main主进程和Renderer渲染进程, 两者的通信也是需要用到 IPC(inter-process-communication)
- 由于进程之间数据相互隔离, 因此进程间通信需要使用内核 内核开辟一块数据缓冲区域, 将进程a的数据copy到缓冲区, b进程再将数据从缓冲区读取
- 管道, 消息队列, 共享内存, socket 都属于较为常见的IPC方式

## 再用一个形象例子解释

- 操作系统类似于一个工厂
- 工厂中里有很多车间, 这个车间就是进程
- 每个车间可能有一个以上的工人在工厂, 这个工人就是线程

## 操作系统的工作方式

- 操作系统是如何做到同时让多个进程(边听歌, 边写代码, 边查阅资料) 同时工作呢?

> 这是因为 CPU的运算速度非常快, 它可以 快速的在多个进程之间迅速的切换
> 当我们 进程中的线程 获取到 时间片 时, 就可以快速执行我们编写的代码
> 对于用户来说 是感受不到这种快速的切换 的

- 你可以在Mac的活动监视器 或者 Windows的资源管理器 中查看到很多进程

## 浏览器中的 JavaScript线程

- 我们经常会说 JavaScript是单线程的, 但是 JavaScript的线程应该有自己的容器进程: 浏览器或者Node
- 浏览器是一个进程吗, 它里面只有一个线程吗?

> 目前 多数的浏览器其实都是多进程的, 当我们打开一个tab页面时就会开启一个新的进程, 这是为了防止一个页面卡死而造成所有页面无法响应, 整个浏览器需要强制退出
> 每个进程中又有很多的线程, 其中 包括执行JavaScript代码的线程

- JavaScript的代码执行是在 一个单独的线程中执行的:

> 这就意味着JavaScript代码, 在同一个时刻只能做一件事
> 如果这件事 是非常耗时的, 就意味着当前的线程就会被阻塞

- 所以真正耗时的操作, 实际上并不是由JavaScript线程在执行的

> 浏览器的每个进程是多线程的, 那么其他线程可以来完成这个耗时的操作
> 比如网络请求, 定时器, 我们只需要在特定的时候执行应该有的回到即可
