# 内存管理

- 不管什么样的编程语言, 在代码的执行过程中都是需要给它分配内存的, 不同的是某些编程语言需要我们自己手动的管理内存, 某些编程语言会可以自动帮助我们管理内存
- 不管以什么样的方式来管理内存, 内存的管理都会有如下的声明周期: 

> 第一步: 分配申请你需要的内存(申请);
> 第二步: 使用分配的内存(存放一些东西, 比如对象等);
> 第三步: 不需要使用时, 对其进行释放 

- 不同的编程语言对于第一步和第三步会有不同的实现

> 手动管理内存: 比如 C, C++, 包括早期的OC, 都是需要手动来管理内存的申请和释放的(malloc 和 free 函数);
> 自动管理内存: 比如Java, JavaScript, Python, swift, Dart等. 她们有自动帮助我们管理内存

## JS的内存管理 

- JavaScript会在定义变量时为我们分配内存
- 但是内存分配方式时一样的吗?

> JS对于基本数据类型内存的分配会在执行时, 直接在栈空间进行分配;
> JS对于复杂数据类型内存的分配会在堆内存中开辟一块空间, 并且将这块空间的指针返回值变量引用

```
   栈结构                                     堆结构

var name = "why"
var age = 18              引用
var obj = 0x100        ------------->       0x100  { name: "james", age: 38}
```

## JS的垃圾回收

- 因为内存的大小是有限的,所以当内存不在需要的时候, 我们需要对其进行释放, 以便腾出更多的内存空间
- 在手动管理内存的语言中, 我们需要通过一些方式自己来释放不在需要的内存, 比如 free 函数:

> 但是这种管理的方式其实非常的低效, 影响我们编写逻辑的代码的效率;
> 并且这种方式对开发者的要求也很高, 并且一不小心就会产生内存泄漏;

- 所以大部分现代的编程语言有自己的垃圾回收机制

> 垃圾回收的英文是 Garbage Collection, 简称 GC;
> 对于那些不再使用的对象, 我们都称之为是 垃圾, 它需要被回收, 以释放更多的内存空间;
> 而我们的语言运行环境, 比如Java的运行环境JVM, JavaScript的运行环境js引擎都会内存 垃圾回收器;
> 垃圾回收器 我们也会简称为 GC, 所以在很多地方你看到 GC 其实指的是 垃圾回收器

- 但是这里又出现了另外一个很关键的问题: GC怎么知道哪些对象是不再使用的呢?  

## 这里就要用到 GC 的算法

- 引用计数, 弊端: 循环引用
- 标记清除

> 这个算法是设置一个跟对象 (root object), 垃圾回收器会定期从这个根开始, 找所有从根开始有引用到的对象, 对于哪些
> 没有引用到的对象, 就认为是不可用的对象
> 这个算法可以很好的解决循环引用的问题; 

- JS引擎比较广泛的采用的就是标记清除算法, 当然类似于V8引擎为了进行更好的优化, 它在算法的实现细节上也会结合一些其他的算法.